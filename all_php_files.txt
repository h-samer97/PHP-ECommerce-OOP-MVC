==================================================
=== FILE: ./Views/Pages/Main/404.php
==================================================
<?php

use Core\Helper\URL;
use Views\Layouts\Footer;
use Views\Layouts\Head;

echo (new Head('404', '404'))->Render(); ?>

<img src="<?php echo URL::ico('404') ?>" alt="error404" class="E404">

<?php echo (new Footer('script', 'echarts.min'))->Render(); ?>


==================================================
=== FILE: ./Views/Pages/Main/Dashboard.php
==================================================
<?php

use Views\Layouts\Navbar;
use Core\Database\DBConnection;
use Repositories\UserRepository;
use Core\Helper\URL;

// دالة مساعدة مختصرة للترميز الآمن
function e($string) {
    return htmlspecialchars($string, ENT_QUOTES, 'UTF-8');
}

?>
<main>
    <?php echo (new Navbar())->Render(); ?>
    <section class="dashboard-container">
        <div class="dashboard-stats">

            <!-- Bar Dashboard -->
            <div class="d-bar">
                <input type="text" id="searchBox" placeholder="Search Here...">
                <div class="sb-resultes"></div>
                <button>
                    <i class="fas fa-solid fa-bell"></i>
                </button>
            </div>

            <div class="d-hello">
                <h3>Lorem ipsum dolor sit amet consectetur.</h3>
                <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Numquam.</p>
            </div>

            <!-- Charts -->
            <div class="charts-row">
                <div class="chart-box">
                    <h4>إحصائية تسجيل المستخدمين حسب السنة</h4>
                    <canvas id="charts"></canvas>
                </div>
                <div class="chart-box">
                    <h4>عدد العناصر حسب الفئة</h4>
                    <canvas id="categoryChart"></canvas>
                </div>
            </div>

            <div class="d-stats-info">
                <div class="d-pie">
                    <?php
                        $repo = new UserRepository((new DBConnection())->getConnection());
                        echo e($repo->sumCountAllUsers());
                    ?>
                </div>
                <div class="d-line">
                    charts
                </div>
            </div>
        </div>

        <div class="dashboard-info">
            <h3>My Profile</h3>
            <div class="d-profile">
                <div class="d-profile-name">
                    <img src="<?php echo e(URL::ico('editmembers')); ?>" alt="">
                    <div class="d-txt">
                        <h4><?php echo e($user->name ?? 'Guest'); ?></h4>
                        <span><?php echo e($user->bio ?? 'No bio available'); ?></span>
                        <div class="d-addr">
                            <i class="fa fa-map-marker"></i> 
                            <span><?php echo e($user->address ?? 'Unknown'); ?></span>
                        </div>
                    </div>
                </div>
                <div class="d-profile-box">
                    <div>
                        <span>lorem</span>
                        <p><?php echo e($user->posts ?? 0); ?></p>
                    </div>
                    <div>
                        <span>lorem</span>
                        <p><?php echo e($user->comments ?? 0); ?></p>
                    </div>
                    <div>
                        <span>lorem</span>
                        <p><?php echo e($user->followers ?? 0); ?></p>
                    </div>
                </div>
            </div>

            <div class="d-commends">
                <h3>Last 10 Commends</h3>
                <div class="d-c-list">
                    <?php foreach($comments as $comment): ?>
                        <span><?php echo e($comment['text']); ?></span>
                    <?php endforeach; ?>
                </div>
            </div>
        </div>
    </section>
</main>



==================================================
=== FILE: ./Views/Pages/Main/Login.php
==================================================
<?php

    if(!empty($alertMessage)) echo $alertMessage;

?>

<form action="<?php echo BASE_URL . 'login'; ?>" method="post" class="login">
        <h2>login system</h2>
        <input type="text" placeholder="username" name="username" class="username">
        <input type="password" placeholder="password" name="password" class="password">
        <div class="password-box">
            <i class="fa fa-eye" id="eye"></i> show password
        </div>
        <input type="submit" value="Login" class="input-button">
        <div class="login-icon">
            <i class="fab fa-facebook"></i>
            <i class="fab fa-twitter"></i>
            <i class="fab fa-tiktok"></i>
        </div>
</form>


==================================================
=== FILE: ./Views/Pages/test.php
==================================================
<?php

use Core\Helper\Alert;
use Services\CSRFToken;
use Views\Layouts\Head;

echo (new Head('', ''))->Render();

// include BASE_PATH . '/Core/Config/Config.php';

// $url = "https://api.exchangerateapi.net/v1/latest?base=USD";
// $headers = ["apikey: " . EXCHANGE_RATE_API_KEY];

// $ch = curl_init($url);
// curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
// curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
// $response = curl_exec($ch);
// unset($ch);

// $data = json_decode($response, true);

// if (isset($data['data']) && is_array($data['data'])) {
//     echo "<h3>Exchange Rates (Base USD)</h3><ul>";
//     foreach ($data['data'] as $currency => $info) {
//         echo "<li><strong>{$currency}</strong> → {$info['value']}</li>";
//     }
//     echo "</ul>";
// }

// if (isset($data['meta'])) {
//     echo "<p>Last updated: " . htmlspecialchars($data['meta']['last_updated_at']) . "</p>";

  echo $_SERVER['REQUEST_URI'];

  $uri = parse_url($server['REQUEST_URI'] ?? '/', PHP_URL_PATH) ?? '/';

?>



==================================================
=== FILE: ./Views/Pages/Currencies/CurrDashboard.php
==================================================
<?php

    use Views\Layouts\Head;
    use Views\Layouts\Footer;

    echo (new Head('Add Member', 'addMember'))->Render();
?>

    <div class="curr-main">

        <div class="curr-nav">
            <h3>converter</h3>

            <div class="curr-nav-time">
                <span class="curr-h">00</span>
                <span class="curr-m">00</span>
                <span class="curr-s">00</span>
            </div>
            <div class="curr-last-update">
                last Update
                <div class="clu-l">
                    2010-01-01
                </div>
            </div>

        </div>

    </div>

<?php

    echo (new Footer('script', 'chart.umd.min'))->Render();

?>


==================================================
=== FILE: ./Views/Pages/Members/MemberManage.php
==================================================
<?php

use Views\Layouts\Footer;
use Views\Layouts\Head;
use Core\Helper\FlashMessage;

// دالة مساعدة مختصرة للترميز الآمن
function e($string) {
    return htmlspecialchars($string, ENT_QUOTES, 'UTF-8');
}

echo (new Head('Add Member', 'addMember'))->Render();

FlashMessage::init();
FlashMessage::display();

?>
<div class="container">
    <h1>لوحة إدارة الأعضاء</h1>
    <table>
      <thead>
        <tr>
          <th>#ID</th>
          <th>Username</th>
          <th>Email</th>
          <th>Full Name</th>
          <th>Date Register</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
       <?php foreach ($rows as $row): ?>
        <tr>
          <td><?php echo e($row['UserID']); ?></td>
          <td><?php echo e($row['Username']); ?></td>
          <td><?php echo e($row['Email']); ?></td>
          <td><?php echo e($row['FullName']); ?></td>
          <td><?php echo e($row['Date_Reg']); ?></td>
          <td>
            <a class='btn-blue' href="<?php echo BASE_URL . 'members/' . e($row['UserID']) . '/edit'; ?>" class="table-control">Edit</a>
            <?php if($row['RegStatus'] == 0){ ?>
              <a class='btn-green' href="<?php echo BASE_URL . 'members/' . e($row['UserID']) . '/accept'; ?>" class="table-control">Accept</a>
            <?php } ?>
            <a class='btn-red' href="<?php echo BASE_URL . 'members/' . e($row['UserID']) . '/delete'; ?>" class="table-control">Delete</a>
          </td>
        </tr>
       <?php endforeach; ?>
      </tbody>
    </table>
    <button class="add-member">+ إضافة عضو جديد</button>
</div>
<?php 
echo (new Footer('script', 'chart.umd.min'))->Render();
?>



==================================================
=== FILE: ./Views/Pages/Members/AddMember.php
==================================================
<?php

use Views\Layouts\Footer;
use Views\Layouts\Head;
use Core\Helper\FlashMessage;
use Services\CSRFToken;

function e($string) {
    return htmlspecialchars($string, ENT_QUOTES, 'UTF-8');
}

echo (new Head('Add Member', 'addMember'))->Render();

FlashMessage::init();
FlashMessage::display();

?>
<form class="edit-form" method="POST" action="<?php echo BASE_URL . 'members/insert'; ?>">
  <h2><i class="fa fa-user-edit"></i> Add a Member</h2>

  <div class="form-group">
    <label for="username" class="required">Username</label>
    <input type="text" id="username" placeholder="Enter username" name="username" 
           value="<?php echo isset($row['Username']) ? e($row['Username']) : '' ?>" required>
           <?php
                $token = new CSRFToken();
                $token->generateFieldToken();
            ?>
  </div>

  <div class="form-group">
    <label for="password" class="required">Password</label>
    <input type="password" id="password" placeholder="Enter password" 
           name="newPassword" value="">
  </div>

  <div class="form-group">
    <label for="email" class="required">Email</label>
    <input type="email" id="email" placeholder="Enter email" name="email" 
           value="<?php echo isset($row['Email']) ? e($row['Email']) : '' ?>" required>
  </div>

  <div class="form-group">
    <label for="fullname" class="required">Full Name</label>
    <input type="text" id="fullname" placeholder="Enter full name" name="fullName" 
           value="<?php echo isset($row['FullName']) ? e($row['FullName']) : '' ?>">
  </div>

  <button type="submit" class="btn-save"><i class="fa fa-save"></i> Save</button>
</form>

<?php 
echo (new Footer('script', 'chart.umd.min'))->Render();
?>



==================================================
=== FILE: ./Views/Pages/Members/EditMembers.php
==================================================
<?php

use Services\CSRFToken;
use Views\Layouts\Footer;
use Views\Layouts\Head;

function e($string) {
    return htmlspecialchars($string, ENT_QUOTES, 'UTF-8');
}
echo ( new Head('Edit Member', 'edit') )->Render();
?>
<form class="edit-form" method="POST" action="<?php echo BASE_URL . 'members/update'; ?>">
    <h2><i class="fa fa-user-edit"></i> Edit Member</h2>

    <div class="form-group">
      <label for="username" class="required">Username</label>
      <input type="hidden" name="userid" value="<?php echo e($userRecord->userID) ?>">
      <input type="text" id="username" placeholder="Enter username" name="username" 
             value="<?php echo e($userRecord->username) ?>" required>

             <?php
                $token = new CSRFToken();
               echo $token->generateFieldToken();
            ?>

    </div>

    <div class="form-group">
      <label for="password">Password</label>
      <input type="password" id="password" placeholder="Enter password" value="" name="newPassword">
      <input type="hidden" name="oldPassword" value="<?php echo e($userRecord->password) ?>">
    </div>

    <div class="form-group">
      <label for="email" class="required">Email</label>
      <input type="email" id="email" placeholder="Enter email" 
             value="<?php echo e($userRecord->email) ?>" name="email" required>
    </div>

    <div class="form-group">
      <label for="fullname" class="required">Full Name</label>
      <input type="text" id="fullname" placeholder="Enter full name" 
             value="<?php echo e($userRecord->fullName) ?>" name="fullName">
    </div>

    <button type="submit" class="btn-save"><i class="fa fa-save"></i> Save</button>
</form>
<?php

    echo ( new Footer('script', '') )->Render();

?>


==================================================
=== FILE: ./Views/Pages/Items/EditItem.php
==================================================
<?php

use Views\Layouts\Footer;
use Views\Layouts\Head;
use Core\Helper\FlashMessage;
use Services\CSRFToken;

// دالة مساعدة مختصرة للترميز الآمن
function e($string) {
    return htmlspecialchars($string, ENT_QUOTES, 'UTF-8');
}

echo (new Head('Add Category', 'addMember'))->Render();

FlashMessage::init();
FlashMessage::display();

?>
<div class="form-card">
  <h2><i class="fas fa-plus-circle"></i> Add New Item</h2>
  <form method="POST" action="<?php echo BASE_URL . 'items/' . e($row['Item_id']) . '/update' ?>">
    <div class="form-group">
      <label for="item-name">Name of The Item</label>
      <div class="input-icon">
        <i class="fas fa-tag"></i>
        <input type="text" id="item-name" name="item-name" value="<?php echo e($row['Item_name']) ?>" />
        <input type="hidden" name="item-id" value="<?php echo e($row['Item_id']) ?>" />
          <?php

              $csrf = new CSRFToken();
              echo $csrf->generateFieldToken();

          ?>
      </div>
    </div>

    <div class="form-group">
      <label for="item-description">Description of The Item</label>
      <div class="input-icon">
        <i class="fas fa-align-left"></i>
        <textarea id="item-description" name="item-description"><?php echo e($row['Item_description']) ?></textarea>
      </div>
    </div>

    <div class="form-group">
      <label for="item-price">Price of The Item</label>
      <div class="input-icon">
        <i class="fas fa-dollar-sign"></i>
        <input type="text" id="item-price" min="0" name="item-price" value="<?php echo e($row['Price']) ?>"/>
      </div>
    </div>

    <div class="form-group">
      <label for="item-country">Country of Made </label>
      <div class="input-icon">
        <i class="fas fa-globe"></i>
        <input type="text" id="item-country" name="item-country" value="<?php echo e($row['Country_Made']) ?>" />
      </div>
    </div>

    <div class="form-group">
      <label for="item-status">Status</label>
      <div class="input-icon">
        <i class="fas fa-info-circle"></i>
        <select id="item-status" name="item-status" required>
          <option value="new" <?php echo ($row['Status_Item'] === 'new') ? 'selected' : ''; ?>>New</option>
          <option value="used" <?php echo ($row['Status_Item'] === 'used') ? 'selected' : ''; ?>>Used</option>
          <option value="refurbished" <?php echo ($row['Status_Item'] === 'refurbished') ? 'selected' : ''; ?>>Refurbished</option>
        </select>
      </div>
    </div>

    <div class="form-group">
      <label for="item-rating">Rating</label>
      <div class="input-icon">
        <i class="fas fa-star"></i>
        <select id="item-rating" name="item-rating">
          <option value="0" <?php echo ($row['Rating'] == 0) ? 'selected' : ''; ?>>0 - No Rating</option>
          <option value="1" <?php echo ($row['Rating'] == 1) ? 'selected' : ''; ?>>1 - Poor</option>
          <option value="2" <?php echo ($row['Rating'] == 2) ? 'selected' : ''; ?>>2 - Fair</option>
          <option value="3" <?php echo ($row['Rating'] == 3) ? 'selected' : ''; ?>>3 - Good</option>
          <option value="4" <?php echo ($row['Rating'] == 4) ? 'selected' : ''; ?>>4 - Very Good</option>
          <option value="5" <?php echo ($row['Rating'] == 5) ? 'selected' : ''; ?>>5 - Excellent</option>
        </select>
      </div>
    </div>

    <div class="form-group">
      <label for="cat-id">Category</label>
      <div class="input-icon">
        <i class="fas fa-folder-open"></i>
        <select id="cat-id" name="cat-id">
          <option value="">Select Category</option>
          <?php
              foreach($Cats as $Cat) {
                  echo '<option value="' . e($Cat['ID']) . '">' . e($Cat['Name']) . '</option>';
              }
          ?>
        </select>
      </div>
    </div>

    <div class="form-group">
      <label for="member-id">Member</label>
      <div class="input-icon">
        <i class="fas fa-user"></i>
        <select id="member-id" name="member-id">
          <option value="">Select Member</option>
          <?php
              foreach($Members as $Member) {
                  echo '<option value="' . e($Member['UserID']) . '">' . e($Member['Username']) . '</option>';
              }
          ?>
        </select>
      </div>
    </div>

    <button type="submit" class="submit-btn">
      <i class="fas fa-edit"></i> Edit Item
    </button>
  </form>
</div>

<?php
echo (new Footer('script', 'chart.umd.min'))->Render();
?>



==================================================
=== FILE: ./Views/Pages/Items/AddItem.php
==================================================
<?php

use Core\Helper\FlashMessage;
use Views\Layouts\Footer;
use Views\Layouts\Head;

function e($string) {
    return htmlspecialchars($string, ENT_QUOTES, 'UTF-8');
}

echo (new Head('Add Category', 'addMember'))->Render();

FlashMessage::init();
FlashMessage::display();

?>
<div class="form-card">
  <h2><i class="fas fa-plus-circle"></i> Add New Item</h2>
  <form method="POST" action="">
    <!-- باقي الحقول كما هي -->
    
    <div class="form-group">
      <label for="cat-id">Category <span>*</span></label>
      <div class="input-icon">
        <i class="fas fa-folder-open"></i>
        <select id="cat-id" name="cat-id" required>
          <option value="">Select Category</option>
          <?php
              foreach($Cats as $Cat) {
                  echo '<option value="' . e($Cat['ID']) . '">' . e($Cat['Name']) . '</option>';
              }
          ?>
        </select>
      </div>
    </div>

    <div class="form-group">
      <label for="member-id">Member <span>*</span></label>
      <div class="input-icon">
        <i class="fas fa-user"></i>
        <select id="member-id" name="member-id" required>
          <option value="">Select Member</option>
          <?php
              foreach($Members as $Member) {
                  echo '<option value="' . e($Member['UserID']) . '">' . e($Member['Username']) . '</option>';
              }
          ?>
        </select>
      </div>
    </div>

    <button type="submit" class="submit-btn">
      <i class="fas fa-plus"></i> Add Item
    </button>
  </form>
</div>



==================================================
=== FILE: ./Views/Pages/Categories/ShowCategories.php
==================================================
<?php

use Views\Layouts\Footer;
use Views\Layouts\Head;
use Core\Helper\FlashMessage;

// دالة مساعدة مختصرة
function e($string) {
    return htmlspecialchars($string, ENT_QUOTES, 'UTF-8');
}

echo ( new Head('Categories', '') )->Render();

FlashMessage::init();
FlashMessage::display();

?>

<main class="all-categories">

    <?php 
        foreach($rows as $row) {
            echo '<div class="cat-section">';
            echo '<h4>' . e($row['Name']) . '</h4>';
            echo '<a href="categories/' . e($row['ID']) . '/edit">edit</a> 
                  <a href="categories/' . e($row['ID']) . '/delete">delete</a>';
            
            echo '<div class="cat">';
            
            foreach($items as $item) {
                if($row['ID'] == $item['ICI']) {
                    echo '<div>' . e($item['Name']) . '</div>';
                }
            }

            echo '<p>' . e($row['Description']) . '</p>';
            
            echo '<div class="cat-config">';
                echo e($row['Order']);
                echo e($row['Visibility']);
                echo e($row['Allow_Comment']);
                echo e($row['Allow_Ads']);
            echo '</div>';

            echo '<a href="" class="cat-view">View</a>';
            echo '</div>';
        }      
    ?>
    </div>

</main>

<?php
echo ( new Footer('script', '') )->Render();
?>



==================================================
=== FILE: ./Views/Pages/Categories/AddCategory.php
==================================================
<?php

use Views\Layouts\Footer;
use Views\Layouts\Head;
use Core\Helper\FlashMessage;

 echo (new Head('Add Category', 'addMember'))->Render();

        FlashMessage::init();
        FlashMessage::display();

?>
<form class="container" method="POST" action="<?php echo BASE_URL . 'categories/add'; ?>">
<div class="card">
  <div class="card-header">
    <h2>Add a new Category</h2>
  </div>
  <!-- ضع العناصر التالية داخل هذه البطاقة -->
</div>
<div class="field">
  <label class="label">
    Category Name
    <span class="req" aria-hidden="true">*</span>
  </label>
  <input type="text" class="input" placeholder="" required name="name">
</div>
<div class="field">
  <label class="label">Description Category</label>
  <textarea class="textarea" rows="3" placeholder="Describe" name="description"></textarea>
</div>
<div class="field">
  <label class="label">Sort</label>
  <div class="number-wrap">
    <input type="number" class="input number-input" min="0" step="1" placeholder="ex: 10" name="order">
    <span class="suffix">#</span>
  </div>

</div>
<div class="field">
  <label class="label">Visibility</label>
  <div class="radio-group">
    <label class="radio-item">
      <input type="radio" name="visible" value="1" checked>
      <span class="switch"><span class="dot"></span></span>
      <span class="text">Yes</span>
    </label>
    <label class="radio-item">
      <input type="radio" name="visible" value="0">
      <span class="switch"><span class="dot"></span></span>
      <span class="text">No</span>
    </label>
  </div>
</div>

<div class="field">
  <label class="label">Allow Comments </label>
  <div class="radio-group">
    <label class="radio-item">
      <input type="radio" name="comments" value="1" checked>
      <span class="switch"><span class="dot"></span></span>
      <span class="text">Yes</span>
    </label>
    <label class="radio-item">
      <input type="radio" name="comments" value="0">
      <span class="switch"><span class="dot"></span></span>
      <span class="text">No</span>
    </label>
  </div>
</div>

<div class="field">
  <label class="label">Allow Ads </label>
  <div class="radio-group">
    <label class="radio-item">
      <input type="radio" name="ads" value="1" checked>
      <span class="switch"><span class="dot"></span></span>
      <span class="text">Yes</span>
    </label>
    <label class="radio-item">
      <input type="radio" name="ads" value="0">
      <span class="switch"><span class="dot"></span></span>
      <span class="text">No</span>
    </label>
  </div>
</div>
<div class="actions">
  <button type="submit" class="btn-primary">
    Add Category
  </button>
</div>
</form>
<?php 


    echo (new Footer('script', 'chart.umd.min'))->Render();


?>


==================================================
=== FILE: ./Views/Pages/Categories/EditCategory.php
==================================================
<?php

use Views\Layouts\Footer;
use Views\Layouts\Head;
use Core\Helper\FlashMessage;
use Services\CSRFToken;

# helper Func
function e($string) {
    return htmlspecialchars($string, ENT_QUOTES, 'UTF-8');
}

echo (new Head('Add Category', 'addMember'))->Render();

FlashMessage::init();
FlashMessage::display();

?>
<form class="container" method="POST" action="<?php echo BASE_URL . 'categories/' . e($rows->ID) . '/update' ?>">
<div class="card">
  <div class="card-header">
    <h2>Edit Category</h2>
  </div>
</div>

<div class="field">
  <label class="label">
    Category Name
    <span class="req" aria-hidden="true">*</span>
  </label>
  <input type="text" class="input" name="name" value="<?php echo e($rows->Name) ?>">
  <input type="hidden" name="id" value="<?php echo e($rows->ID) ?>">
        <?php

              $csrf = new CSRFToken();
              echo $csrf->generateFieldToken();

        ?>
</div>

<div class="field">
  <label class="label">Description Category</label>
  <textarea class="textarea" rows="3" name="description"><?php echo e($rows->Description) ?></textarea>
</div>

<div class="field">
  <label class="label">Sort</label>
  <div class="number-wrap">
    <input type="number" class="input number-input" min="0" step="1" name="order" value="<?php echo e($rows->Order) ?>">
    <span class="suffix">#</span>
  </div>
</div>

<div class="field">
  <label class="label">Visibility</label>
  <div class="radio-group">
    <label class="radio-item">
      <input type="radio" name="visible" value="1" <?php if($rows->Visibility == 1) echo 'checked' ?>>
      <span class="switch"><span class="dot"></span></span>
      <span class="text">Yes</span>
    </label>
    <label class="radio-item">
      <input type="radio" name="visible" value="0" <?php if($rows->Visibility == 0) echo 'checked' ?>>
      <span class="switch"><span class="dot"></span></span>
      <span class="text">No</span>
    </label>
  </div>
</div>

<div class="field">
  <label class="label">Allow Comments </label>
  <div class="radio-group">
    <label class="radio-item">
      <input type="radio" name="comments" value="1" <?php if($rows->Allow_Comment == 1) echo 'checked' ?>>
      <span class="switch"><span class="dot"></span></span>
      <span class="text">Yes</span>
    </label>
    <label class="radio-item">
      <input type="radio" name="comments" value="0" <?php if($rows->Allow_Comment == 0) echo 'checked' ?>>
      <span class="switch"><span class="dot"></span></span>
      <span class="text">No</span>
    </label>
  </div>
</div>

<div class="field">
  <label class="label">Allow Ads </label>
  <div class="radio-group">
    <label class="radio-item">
      <input type="radio" name="ads" value="1" <?php if($rows->Allow_Ads == 1) echo 'checked' ?>>
      <span class="switch"><span class="dot"></span></span>
      <span class="text">Yes</span>
    </label>
    <label class="radio-item">
      <input type="radio" name="ads" value="0" <?php if($rows->Allow_Ads == 0) echo 'checked' ?>>
      <span class="switch"><span class="dot"></span></span>
      <span class="text">No</span>
    </label>
  </div>
</div>

<div class="actions">
  <button type="submit" class="btn-primary">
    Update Category
  </button>
</div>
</form>

<?php 
echo (new Footer('script', 'chart.umd.min'))->Render();
?>



==================================================
=== FILE: ./Views/Layouts/Footer.php
==================================================
<?php

    namespace Views\Layouts;

use Core\Helper\URL;
use Core\Interfaces\ILayouts;

    class Footer implements ILayouts {

        // protected ?string $path1 = null;
        protected string $js;
        protected string $charts;

        public function __construct(?string $path1, ?string $path2)
        {
                $this->charts   = URL::js($path1);
                $this->js       = URL::js($path2);
        }

        public function Render(): string
        {
            return <<< HTML
            </body>
                <script src="{$this->charts}" type="module" defer></script>
                <script src="{$this->js}" type="module" defer></script>
            </html>
            HTML;    
        }

    }






?>


==================================================
=== FILE: ./Views/Layouts/Navbar.php
==================================================
<?php

    namespace Views\Layouts;

use Core\Database\DBConnection;
use Core\Interfaces\ILayouts;
use Repositories\UserRepository;
use Services\LanguageLoader;

    class Navbar implements ILayouts {

        private LanguageLoader $language;
        private UserRepository $getUsername;
        private $Username;
        private string $urlLogout = BASE_URL . 'logout';

        public function Render(): string
        {
            $this->language = new LanguageLoader('en');
            $this->getUsername = new UserRepository( (new DBConnection())->getConnection() );
            $this->Username = $this->getUsername->findById($_SESSION['UserID']);
            $editUrl = BASE_URL . 'members?do=edit&userid=' . $_SESSION['UserID'];

            return <<< HTML

            <nav class='main-nav-bar'>

                <div class="container">
                    <ul class='mnb-list'>
                        <li>
                            <a href="">{$this->language::getKeyword('home')}</a>
                        </li>

                        <li>
                            <a href="/categories">{$this->language::getKeyword('categories')}</a>
                        </li>

                        <li>
                            <a href="">{$this->language::getKeyword('members')}</a>
                        </li>

                        <li>
                            <a href="">{$this->language::getKeyword('item')}</a>
                        </li>

                        <li>
                            <a href="">{$this->language::getKeyword('logs')}</a>
                        </li>

                        <li>
                            <a href="">{$this->language::getKeyword('statistics')}</a>
                        </li>

                    </ul>

                    <div class="nav-drop-down">
                        <span>{$this->Username->getUsername()}</span>
                            <ul class="ndd-list">
                                <li>
                                    <a href="{$editUrl}"><i class=''></i> {$this->language::getKeyword('editmember')} </a>
                                </li>

                                <li>
                                    <a href=""><i class=''></i> {$this->language::getKeyword('settings')} </a>
                                </li>

                                <li>
                                    <a href="{$this->urlLogout}"><i class=''></i> {$this->language::getKeyword('logout')} </a>
                                </li>
                            </ul>
                    </div>

                </div>

            </nav>


            HTML;
        }

    }


==================================================
=== FILE: ./Views/Layouts/Head.php
==================================================
<?php

    namespace Views\Layouts;

    use Core\Abstracts\AbstractLayouts;
    use Core\Interfaces\ILayouts;
    use Core\Helper\URL;

    class Head extends AbstractLayouts implements ILayouts {

        protected string $title  = 'Defualt';
        protected $css;
        protected $fontAwesome;
        protected $favicon;

        public function __construct($title, $ico)
        {
            // $this->url = ;
            $this->title = $title;
            $this->css = URL::css('style');
            $this->fontAwesome = URL::css('all.min');
            $this->favicon = URL::ico($ico);
        }

                public function Render() : string {
        
                    return <<< HTML
                        <!DOCTYPE html>
                        <html lang="en">
                        <head>
                            <meta charset="UTF-8">
                            <meta name="viewport" content="width=device-width, initial-scale=1.0">
                            <link rel="stylesheet" href="{$this->css}">
                            <link rel="stylesheet" href="{$this->fontAwesome}">
                            <link rel="shortcut icon" href="{$this->favicon}" type="image/x-icon">
                            <title>{$this->title}</title>
                        </head>
                        <body>
                        
                        HTML;
                }

    }





?>


==================================================
=== FILE: ./Views/Layouts/Sidebar.php
==================================================
<?php

    use Core\Helper\URL;
use Services\LanguageLoader;
use Views\Layouts\Footer;
    use Views\Layouts\Head;
    echo (new Head('404', '404'))->Render();

?>
<aside>
    <i class="fa fa-bars side-br"></i>
    <span> <i class="fa fa-shopping-cart"></i> Ecomm</span>
    <ul class="side-list">
        <li class="active"><i class="fa fa-home"></i><a href="">Home</a></li>
        <li><i class="fa fa-home"></i><a href="/dashboard"><span><?php echo LanguageLoader::getKeyword('home') ?></span></a></li>
        <li><i class="fa fa-home"></i><a href="categories"><span><?php echo LanguageLoader::getKeyword('categories') ?></span></a></li>
        <li><i class="fa fa-home"></i><a href="memebrs"><span><?php echo LanguageLoader::getKeyword('members') ?></span></a></li>
        <li><i class="fa fa-home"></i><a href=""><span><?php echo LanguageLoader::getKeyword('logs') ?></span></a></li>
        <li><i class="fa fa-home"></i><a href="logout"><span><?php echo LanguageLoader::getKeyword('logout') ?></span></a></li>
    </ul>
    <a href="/logout">logout</a>
</aside>

<?php echo (new Footer('script', 'chart.umd.min'))->Render(); ?>


==================================================
=== FILE: ./Views/Components/LoadingIcon.php
==================================================
<?php

    namespace Views\Components;

    use Core\Abstracts\AbstractLayouts;
    use Core\Interfaces\ILayouts;
    use Core\Helper\URL;

    class LoadingIcon extends AbstractLayouts implements ILayouts {

        protected string $title  = 'Defualt';
        protected $css;
        protected $fontAwesome;
        protected $favicon;

        public function __construct($title, $ico)
        {
            
        }

                public function Render() : string {
        
                    return <<< HTML
                        
                            <div class='.load-icon'>
                                <img src="{URL::}" alt="">
                            </div>

                        HTML;
                }

    }





?>


==================================================
=== FILE: ./Public/index.php
==================================================
<?php
ini_set('display_errors', 1);
ini_set('display_startup_errors', 1);
error_reporting(E_ALL);

require_once __DIR__ . '/../Core/Bootstrap/Bootstrap.php';
require_once __DIR__ . '/../Core/Router/Router.php';

use Controllers\AuthController;
use Controllers\CategoriesController;
use Controllers\DashboardController;
use Controllers\ItemController;
use Controllers\MembersController;
use Core\Helper\URL;
use Core\Router\Router;
use Middleware\VerifyCsrfToken;
use Services\SessionsServices;

$router = new Router();


$router->add('login', function() {
    $auth = new AuthController();
    $auth->login();
});
$router->add('/', function() {
    $auth = new AuthController();
    $auth->login();
});

$router->add('logout', function() {
    $session = new SessionsServices();
    $session->start();
    $session->destroy();
    URL::redirect('login');
});

/**
 * لوحة التحكم
 */
$router->add('dashboard', function() {
    new SessionsServices();
    $DSH = new DashboardController();
    $DSH->index();
});

/**
 * عرض قائمة الأعضاء
 */
$router->add('members', function() {
    $members = new MembersController();
    $members->index();
});

/**
 * تعديل عضو محدد عبر البارامتر {id}
 * مثال: /members/15/edit
 */
$router->add('members/{id}/edit', function($id) {
    $members = new MembersController();
    $members->edit((int)$id);
});
$router->add('members/{id}/delete', function($id) {
    $members = new MembersController();
    $members->delete((int)$id);
});

$router->add('members/pending', function() {
    $members = new MembersController();
    $members->getPendingUsers();
});
$router->add('members/{id}/accept', function($id) {
    $members = new MembersController();
    $members->acceptUser($id);
});
$router->add('members/{id}/activate', function($id) {
    $members = new MembersController();
    $members->acceptUser($id);
});
$router->add('members/update', function() {
    $members = new MembersController();
    $members->update();
});

$router->add('api/getUsersWithDates', function() {

   $api = new DashboardController();
   $api->getUsersWithDates();

});

$router->add('api/getCats', function() {

    $dashboard = new DashboardController();
    $dashboard->getCats();

});

$router->add('api/getCountryMade', function() {

    $dashboard = new DashboardController();
    $dashboard->getCountryMade();

});

$router->add('api/searchData', function() {

    $dashboard = new DashboardController();
    $dashboard->searchBox();

});

$router->add('members/insert', function() {
    $members = new MembersController();
    $members->insert();
});


$router->add('categories', function() {
    $categories = new CategoriesController();
    $categories->index();
});

$router->add('categories/add', function() {
    $categories = new CategoriesController();
    $categories->insert();
});

$router->add('categories/{id}/edit', function($id) {
    $categories = new CategoriesController();
    $categories->edit($id);
});

$router->add('categories/{id}/update', function($id) {
    $categories = new CategoriesController();
    $categories->update($id);
});

$router->add('categories/{id}/delete', function($id) {
    $categories = new CategoriesController();
    $categories->delete($id);
});

$router->add('items/insert', function() {
    $item = new ItemController();
    $item->insert();
});

$router->add('items/{id}/edit', function($id) {
    $item = new ItemController();
    $item->edit($id);
});

$router->add('items/{id}/update', function($id) {
    $item = new ItemController();
    $item->update($id);
});

$router->add('items/{id}/delete', function($id) {
    $item = new ItemController();
    $item->delete($id);
});

$router->add('items/manage', function($id) {
    $item = new ItemController();
    $item->index();
});

$router->add('test', function() {
        include BASE_PATH . '/Views/Pages/test.php';
});


/**
 * صفحة الخطأ 404
 */
$router->add('404', function() {
    include BASE_PATH . '/Views/Pages/Main/404.php';
});



$middleware = new VerifyCsrfToken();

$middleware->handle(function () {
    // هنا يتابع الراوتر إلى الـ controllers
    // مثال بسيط:
    $uri = parse_url($_SERVER['REQUEST_URI'] ?? '/', PHP_URL_PATH) ?? '/';

    if ($uri === '/profile/update' && $_SERVER['REQUEST_METHOD'] === 'POST') {
        // تنفيذ الأكشن بعد مرور الميدلوير
        echo 'تم التحديث بنجاح';
        return;
    }

});







// تنفيذ التوجيه
$router->dispatch();



==================================================
=== FILE: ./Middleware/VerifyCsrfToken.php
==================================================
<?php


    namespace Middleware;

use Services\CSRFToken;

    class VerifyCsrfToken {


         protected array $except = [
        // '/webhook/provider-x',
        // '/api/public/*',
        ];


        public function handle(callable $next)
    {
        $csrf = new CSRFToken();
        $csrf->ensureToken();

        $server = $_SERVER;
        $post = $_POST;
        $headers = $this->getHeaders();

        $uri = parse_url($server['REQUEST_URI'] ?? '/', PHP_URL_PATH) ?? '/';
        if ($this->isExcept($uri)) {
            return $next();
        }

        if (!$csrf->validateRequest($server, $post, $headers)) {
            http_response_code(419);
            echo $this->expiredPage();
            return null;
        }

        return $next();
    }

    protected function isExcept(string $uri): bool
    {
        foreach ($this->except as $pattern) {
            // دعم wildcards البسيط
            $regex = '#^' . str_replace(['*'], ['.*'], $pattern) . '$#';
            if (preg_match($regex, $uri)) {
                return true;
            }
        }
        return false;
    }

    protected function getHeaders(): array
    {
        $headers = [];
        foreach ($_SERVER as $key => $value) {
            if (str_starts_with($key, 'HTTP_')) {
                $name = str_replace('_', '-', substr($key, 5));
                $headers[$name] = $value;
            }
        }
        return $headers;
    }

    protected function expiredPage(): string
    {
        return '<!doctype html><html lang="ar"><head><meta charset="utf-8"><title>419 - انتهت الصفحة</title></head><body style="font-family:sans-serif;padding:2rem"><h1>419 - انتهت الجلسة</h1><p>انتهت صلاحية الطلب أو فشل التحقق من CSRF. يرجى إعادة تحميل الصفحة والمحاولة مجددًا.</p></body></html>';
    }
}















?>


==================================================
=== FILE: ./Core/Database/DBConnection.php
==================================================
<?php
namespace Core\Database;
use Core\Interfaces\IDBConnection;
use Core\Abstracts\AbstractDBConnection;
use PDO;
use PDOException;

class DBConnection extends AbstractDBConnection implements IDBConnection {

    public function connect(): void {
        if ($this->PDO === null) {
            try {
                $this->PDO = new PDO(
                    $this->DSN,
                    $this->Username,
                    $this->Password,
                    $this->Config
                );
                $this->PDO->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
            } catch (PDOException $e) {
                throw new \Exception("Database connection failed: " . $e->getMessage());
            }
        }
    }

    public function getConnection(): PDO {
        if ($this->PDO === null) {
            $this->connect();
        }
        return $this->PDO;
    }
}
?>


==================================================
=== FILE: ./Core/Config/Config.php
==================================================
<?php
ini_set('display_errors', 1);
ini_set('display_startup_errors', 1);
error_reporting(E_ALL);

// BASE_PATH = جذر المشروع
if (!defined('BASE_PATH')) {
    define('BASE_PATH', realpath(__DIR__ . '/../../') . DIRECTORY_SEPARATOR);
}
// config.php
define("EXCHANGE_RATE_API_KEY", "c220843c-7d3d-45e2-975d-574cdd4b12fc");


// BASE_URL
if (!defined('BASE_URL')) {
    $protocol = (!empty($_SERVER['HTTPS']) && $_SERVER['HTTPS'] !== 'off') ? "https" : "http";
    $host = $_SERVER['HTTP_HOST'];
    $scriptName = str_replace('\\', '/', dirname($_SERVER['SCRIPT_NAME']));
    if (substr($scriptName, -6) === '/Public') {
        $scriptName = substr($scriptName, 0, -6);
    }
    define('BASE_URL', rtrim($protocol . "://" . $host . $scriptName, '/') . '/');
}

// Autoloader
require_once BASE_PATH . 'Core/Autoloader/Autoloader.php';
\Core\Autoloader\Autoloader::register();
?>


==================================================
=== FILE: ./Core/Interfaces/ISessions.php
==================================================
<?php

    namespace Core\Interfaces;

    interface ISessions {

        public function start(): bool;
        public function set(string $key, string $value): bool;
        public function get(string $key) : mixed;
        public function has(string $key): bool;
        public function remove(string $key): void;
        public function destroy(): bool;

        // public function regenerateId(bool $deleteOld = true): void;
        // public function setFlash(string $key, string $message): void;
        // public function getFlash(string $key): ?string;

        // public function all(): array;
        // public function clear(): void;
}

?>


==================================================
=== FILE: ./Core/Interfaces/IDBConnection.php
==================================================
<?php
namespace Core\Interfaces;

use PDO;

interface IDBConnection {
    public function connect(): void;
    public function getConnection(): PDO;
}
?>


==================================================
=== FILE: ./Core/Interfaces/ILanguage.php
==================================================
<?php

    namespace Core\Interfaces;

    interface ILanguage {

        public static function getKeyword ($key) : string;

    }









?>


==================================================
=== FILE: ./Core/Interfaces/ILayouts.php
==================================================
<?php

    namespace Core\Interfaces;

    interface ILayouts {

        public function Render() : string;

    }
    ?>


==================================================
=== FILE: ./Core/Helper/URL.php
==================================================
<?php

  namespace Core\Helper;

class URL {
    public static function js($file): string {
        return \BASE_URL . 'js/' . $file . '.js';
    }

    public static function css($file): string {
        return \BASE_URL . 'css/' . $file . '.css';
    }

    public static function ico($file): string {
        return \BASE_URL . 'ico/' . $file . '.ico';
    }

    public static function language($lang): array {
        return [\BASE_URL . '/Language/' . $lang];
    }

    public static function redirect(string $page): void {
    header('Location: ' . BASE_URL . $page);
    exit();

}

}


?>


==================================================
=== FILE: ./Core/Helper/FlashMessage.php
==================================================
<?php
namespace Core\Helper;

use Services\SessionsServices;

class FlashMessage {

    private static SessionsServices $session;

    public static function init(): void {
        self::$session = new SessionsServices();
    }

    public static function success(string $message): void {
        self::$session->set('flash_message', Alert::Print($message, 'success'));
    }

    public static function error(string $message): void {
        self::$session->set('flash_message', Alert::Print($message, 'error'));
    }

    public static function warning(string $message): void {
        self::$session->set('flash_message', Alert::Print($message, 'warning'));
    }

    public static function info(string $message): void {
        self::$session->set('flash_message', Alert::Print($message, 'info'));
    }

    public static function display(): void {
        if (self::$session->has('flash_message')) {
            echo self::$session->get('flash_message');
            self::$session->remove('flash_message'); // حتى لا تتكرر الرسالة
        }
    }
}



==================================================
=== FILE: ./Core/Helper/Alert.php
==================================================
<?php
namespace Core\Helper;

class Alert {

    /**
     * طباعة رسالة خطأ/تحذير/معلومة
     *
     * @param string $message  نص الرسالة
     * @param string $type     نوع الرسالة: error | warning | info | success
     * @return string          HTML جاهز للطباعة
     */
    public static function Print(string $message, string $type = 'info'): string {
        // تحديد الكلاس المناسب
        $classMap = [
            'error'      => 'alert alert-error',
            'warning'    => 'alert alert-warning',
            'info'       => 'alert alert-info',
            'success'    => 'alert alert-success'
        ];

        $cssClass = $classMap[$type] ?? $classMap['info'];

        return <<<HTML
        <div class="{$cssClass}">
            {$message}
        </div>
        HTML;
    }
}



==================================================
=== FILE: ./Core/Bootstrap/Bootstrap.php
==================================================
<?php

use Services\SessionsServices;

ini_set('display_errors', 1);
ini_set('display_startup_errors', 1);
error_reporting(E_ALL);

// BASE_PATH = Root
if (!defined('BASE_PATH')) {
    define('BASE_PATH', realpath(__DIR__ . '/../../') . DIRECTORY_SEPARATOR);
}

// BASE_URL
if (!defined('BASE_URL')) {
    $protocol = (!empty($_SERVER['HTTPS']) && $_SERVER['HTTPS'] !== 'off') ? "https" : "http";
    $host = $_SERVER['HTTP_HOST'];
    $scriptName = str_replace('\\', '/', dirname($_SERVER['SCRIPT_NAME']));
    if (substr($scriptName, -6) === '/Public') {
        $scriptName = substr($scriptName, 0, -6);
    }
    define('BASE_URL', rtrim($protocol . "://" . $host . $scriptName, '/') . '/');
}

// Autoloader
require_once BASE_PATH . 'Core/Autoloader/Autoloader.php';
\Core\Autoloader\Autoloader::register();

(new SessionsServices())->start();





?>


==================================================
=== FILE: ./Core/Autoloader/Autoloader.php
==================================================
<?php

  namespace Core\Autoloader;

class Autoloader {
    public static function register(): void {
        spl_autoload_register(function ($class) {
            $baseDir = __DIR__ . '/../../'; # => eComm
            $classPath = str_replace('\\', '/', $class) . '.php';
            $file = $baseDir . $classPath;

            if (file_exists($file)) {
                require_once $file;
            }
        });
    }
}


?>


==================================================
=== FILE: ./Core/Router/Router.php
==================================================
<?php
namespace Core\Router;

use Core\Helper\URL;

class Router {
    protected array $routes = [];

    /**
     * تسجيل مسار مع إمكانية وجود بارامترات ديناميكية
     * مثال: members/{id}/edit
     */
    public function add(string $pattern, callable $callback): void {
        // استبدال {param} بـ Regex يلتقط القيمة
        $regex = preg_replace(
            '#\{([a-zA-Z_][a-zA-Z0-9_]*)\}#',
            '(?P<$1>[^/]+)',
            $pattern
        );

        // بناء Regex كامل مع حدود البداية والنهاية
        $regex = '#^' . trim($regex, '/') . '$#i';

        // تخزين المسار
        $this->routes[] = [
            'regex'    => $regex,
            'callback' => $callback
        ];
    }

    /**
     * استخراج المسار المطلوب من الرابط
     * يتجاهل أي Query String أو Fragment
     */
    public function resolvePath(): string {
        $uriPath = parse_url($_SERVER['REQUEST_URI'], PHP_URL_PATH) ?? '/';
        return trim($uriPath, '/');
    }

    /**
     * تنفيذ التوجيه
     */
    public function dispatch(): void {
        $requested = $this->resolvePath();

        foreach ($this->routes as $route) {
            if (preg_match($route['regex'], $requested, $matches)) {
                // استخراج البارامترات المسماة فقط
                $params = array_filter($matches, 'is_string', ARRAY_FILTER_USE_KEY);

                // تنفيذ الكولباك مع البارامترات
                call_user_func_array($route['callback'], $params);
                return;
            }
        }

        // إذا لم يوجد تطابق → 404
        http_response_code(404);
        URL::redirect('404');
    }
}



==================================================
=== FILE: ./Core/Abstracts/AbstractLayouts.php
==================================================
<?php

    namespace Core\Abstracts;

    abstract class AbstractLayouts {

        protected string $title;

    }

?>


==================================================
=== FILE: ./Core/Abstracts/AbstractDBConnection.php
==================================================
<?php
namespace Core\Abstracts;

use Core\Interfaces\IDBConnection;
use PDO;

abstract class AbstractDBConnection {
    protected string $Username = 'root';
    protected string $Password = 'root';
    protected string $DSN      = 'mysql:host=eComm.local;dbname=shop;';
    protected array $Config    = [PDO::MYSQL_ATTR_INIT_COMMAND => 'SET NAMES utf8'];

    protected ?PDO $PDO = null;
}
?>


==================================================
=== FILE: ./Core/Abstracts/AbstractLanguage.php
==================================================
<?php

    namespace Core\Abstracts;

    use Exception;

    abstract class AbstractLanguage {

        protected static array $language = [];


        public static function getKeyword($key) : string {

            return self::$language[$key] ?? 'def';

        }

        public function __construct(string $file = 'en') {

            $langFilePath = BASE_PATH . '/Language/' . $file . '.php';

            if(file_exists($langFilePath)) {

                $translations = include $langFilePath;

                    if(is_array($translations)) {

                        self::$language = $translations;

                    } else {

                        throw new Exception('The language file does not contain a valid array !');

                    }

            } else {

                        throw new Exception('The Language File does NOT Exist');

            }

        }

    }

?>


==================================================
=== FILE: ./Core/Abstracts/AbstractSessions.php
==================================================
<?php

   namespace Core\Abstracts;

use Core\Interfaces\ISessions;
use Exception;

abstract class AbstractSessions implements ISessions {

    public function start(): bool
    {
        $name     = 'ecomm';
        $lifetime = 0;
        $path     = '/';
        $secure   = false; // غيّرها إلى true في HTTPS
        $httpOnly = true;

        if (session_status() === PHP_SESSION_ACTIVE) {
            return false; // Active Current Session
        }

        // Additianl Settings
        ini_set('session.use_strict_mode', '1');
        ini_set('session.use_only_cookies', '1');
        ini_set('session.use_trans_sid', '0');

        session_name($name);

        session_start([
            'cookie_lifetime' => $lifetime,
            'cookie_path'     => $path,
            'cookie_secure'   => $secure,
            'cookie_httponly' => $httpOnly,
        ]);

        return true;
    }

    public function checkIfExist() : bool {

        if(session_status() === PHP_SESSION_ACTIVE) {
            return true;
        } else {
            return false;
        }

    }

    public function set(string $key, string $value) : bool {

        if(session_status() !== PHP_SESSION_ACTIVE) $this->start();

            $_SESSION[$key] = $value;

            return isset($_SESSION[$key]) && $_SESSION[$key] === $value;

    }

    public function get(string $key) : mixed {

        if (session_status() !== PHP_SESSION_ACTIVE) {
            $this->start();
        }

        if (isset($_SESSION[$key]) && is_string($_SESSION[$key])) {
            return $_SESSION[$key];
        }

        return null;
    }

    public function has(string $key): bool {

        if (session_status() !== PHP_SESSION_ACTIVE) {
            $this->start();
        }

        return isset($_SESSION[$key]);
    }

    public function remove(string $key): void {
            
        if (session_status() !== PHP_SESSION_ACTIVE) {
            $this->start();
        }

        if (isset($_SESSION[$key])) {
            unset($_SESSION[$key]);
        }
    }

    public function destroy(): bool {

        if (session_status() !== PHP_SESSION_ACTIVE) {
            $this->start();
        }

        // مسح بيانات الجلسة
        $_SESSION = [];

        // حذف الكوكيز الخاصة بالجلسة
        if (ini_get("session.use_cookies")) {
            $params = session_get_cookie_params();
            setcookie(
                session_name(),
                '',
                time() - 42000,
                $params["path"],
                $params["domain"],
                $params["secure"],
                $params["httponly"]
            );
        }

        // تدمير الجلسة
        return session_destroy();
    }


    
}

?>


==================================================
=== FILE: ./Model/User.php
==================================================
<?php

    namespace Model;

    class User {
        public int $userID;
        public string $username;
        public string $password;
        public string $email;
        public string $fullName;
        public int $userType;
        public int $trustStatus;
        public int $regStatus;
        public string $dateReg;
        public ?string $avatar; // nullable

        public function __construct(
            int $userID,
            string $username,
            string $password,
            string $email,
            string $fullName,
            int $userType,
            int $trustStatus,
            int $regStatus,
            string $dateReg,
            ?string $avatar = null
        ) {
        $this->userID = $userID;
        $this->username = $username;
        $this->password = $password;
        $this->email = $email;
        $this->fullName = $fullName;
        $this->userType = $userType;
        $this->trustStatus = $trustStatus;
        $this->regStatus = $regStatus;
        $this->dateReg = $dateReg;
        $this->avatar = $avatar;
    }

    public function getUsername(): string {
        return $this->username;
    }


}


==================================================
=== FILE: ./Model/Category.php
==================================================
<?php 

    namespace Model;

    class Category {
        public int $ID;
        public string $Name;
        public string $Description;
        public int $Order;
        public int $Visibility;
        public int $Allow_Comment;
        public int $Allow_Ads;

        public function __construct(
            int $ID,
            string $Name,
            string $Description,
            int $Order,
            int $Visibility,
            int $Allow_Comment,
            int $Allow_Ads
        )
        {
            $this->ID = $ID;
            $this->Name = $Name;
            $this->Description = $Description;
            $this->Order = $Order;
            $this->Visibility = $Visibility;
            $this->Allow_Comment = $Allow_Comment;
            $this->Allow_Ads = $Allow_Ads;
        }

    }















?>


==================================================
=== FILE: ./Model/Item.php
==================================================
<?php

namespace Model;

class Item
{
    public int $item_id;
    public string $item_name;
    public string $item_description;
    public string $price;
    public string $add_date;
    public string $country_made;
    public ?string $image;
    public string $status_item;
    public ?int $rating;
    public ?int $cat_id;
    public ?int $member_id;
    public int $approve;

    public function __construct(array $data = [])
    {
        $this->item_id         = $data['item_id'] ?? 0;
        $this->item_name       = $data['item_name'] ?? '';
        $this->item_description= $data['item_description'] ?? '';
        $this->price           = $data['price'] ?? '0';
        $this->add_date        = $data['add_date'] ?? date('Y-m-d H:i:s');
        $this->country_made    = $data['country_made'] ?? '';
        $this->image           = $data['image'] ?? null;
        $this->status_item     = $data['status_item'] ?? '';
        $this->rating          = isset($data['rating']) ? (int)$data['rating'] : null;
        $this->cat_id          = isset($data['cat_id']) ? (int)$data['cat_id'] : null;
        $this->member_id       = isset($data['member_id']) ? (int)$data['member_id'] : null;
        $this->approve         = isset($data['approve']) ? (int)$data['approve'] : 0;
    }
}



==================================================
=== FILE: ./Language/en.php
==================================================
<?php



    return [
        'loginSys' => 'login to system',
        'home' => 'home',
        'categories' => 'categories',
        'members' => 'members',
        'item' => 'item',
        'logs' => 'logs',
        'statistics' => 'statistics',
        'logout' => 'logout',
        'editmember' => 'Member Edit',
        'settings' => 'settings',
    ];







?>


==================================================
=== FILE: ./Services/CSRFToken.php
==================================================
<?php

    namespace Services;

    use Services\SessionsServices;

    class CSRFToken {

        protected string $sessionKey = 'csrf_token';
        protected int $ttlTime = 3600; # 1 Hour - TTL = Time To Live
        protected string $timeStampKey = 'csrf_token_ts';


        public function ensureToken() : void {

            if(session_status() !== PHP_SESSION_ACTIVE) {

                session_start();

                $expired = isset($_SESSION[$this->timeStampKey]) && 
                ( time() - $_SESSION[$this->timeStampKey] > $this->ttlTime );

                if(empty($_SESSION[$this->timeStampKey]) || $expired) {
                    $session = new SessionsServices();
                    $session->set($this->sessionKey, bin2hex(random_bytes(32)));
                    $session->set($this->timeStampKey, time());
                }

            }

        }

        public function getToken() : mixed {

            $this->ensureToken();

            return $_SESSION[$this->sessionKey];

        }

        public function rotateToken() : mixed {

            $session = new SessionsServices();
            $bool = $session->checkIfExist();

            if($bool) {

                $session->set($this->sessionKey, bin2hex(random_bytes(32)));
                $session->set($this->timeStampKey, time());

            }

            return $_SESSION[$this->sessionKey];

        }

        public function generateFieldToken(string $name = '__TOKEN__') : string {

            $token = htmlspecialchars($this->getToken(), ENT_QUOTES, 'UTF-8');
            $field = htmlspecialchars($name, ENT_QUOTES, 'UTF-8');

            return '<input type="hidden" ' . 'name="' . $field . '" value="' . $token . '">'; 

        }
        public function validateRequest(array $server, array $post, array $headers = [], string $paramName = '__TOKEN__'): bool {
            
            $method = strtoupper($server['REQUEST_METHOD'] ?? 'GET');
            if(in_array($method, ['GET', 'HEAD', 'OPTION'])) {
                return true;
            }

            $tokenForm = isset($post[$paramName]) ? (string)$post[$paramName] : null;
            $tokenHeader = isset($headers['X-CSRF-TOKEN']) ? (string)$headers['X-CSRF-TOKEN'] : null;

            if (session_status() !== PHP_SESSION_ACTIVE) {
                session_start();
            }
            
            $sessionToken = $_SESSION[$this->sessionKey] ?? null;

            $match = ($tokenForm && hash_equals($sessionToken ?? '', $tokenForm)) ||
            ($tokenHeader && hash_equals($sessionToken ?? '', $tokenHeader));

            if (!$match) {
                return false;
            }

            return true;


        }


    }










?>


==================================================
=== FILE: ./Services/AuthLogin.php
==================================================
<?php

    namespace Services;

use Core\Helper\Alert;
use Repositories\UserRepository;

    class AuthLogin {

        private UserRepository $repo;

        public function __construct(UserRepository $repo)
        {
            $this->repo = $repo;
        }

        public function verifyLogin(string $username, string $password) {

            $row = $this->repo->findByUsername($username);

            if (!$row) {
                return false;
            };

            if (password_verify($password, $row->password)) {
                return $row;
            }

            return false;

        }

    }






?>


==================================================
=== FILE: ./Services/APIServices.php
==================================================
<?php
namespace Services;

use Repositories\UserRepository;
use Core\Database\DBConnection;
use Repositories\CategoryRepository;
use Repositories\ItemRepository;
use PDO;

class APIServices {
    private UserRepository $userRepo;
    private ItemRepository $itemRepo;
    private CategoryRepository $categoryRepo;

    public function __construct() {
        $this->userRepo = new UserRepository((new DBConnection())->getConnection());
        $this->itemRepo = new ItemRepository((new DBConnection())->getConnection());
        $this->categoryRepo = new CategoryRepository((new DBConnection())->getConnection());
    }

    public function getUsersWithDates(): array {
        return $this->userRepo->getUsersAndDates();
    }

    public function getItemsCountWithCats(): array {
        return $this->itemRepo->getItemFromCategories();
    }

    public function getCountryMade(): array {
        return $this->itemRepo->getCountryMadeAPI();
    }

    public function searchData(): array {
                
        $Conn = (new DBConnection())->getConnection();
        $q    = $_GET['q'] ?? '';
        $resulte = [];
        $SQL1 = 'SELECT `Username` FROM users WHERE Username LIKE ?';
        $SQL2 = 'SELECT `Name` FROM categories WHERE `Name` LIKE ?';
        $SQL3 = 'SELECT `Item_name` FROM items WHERE `Item_name` LIKE ?';

        $stmt = $Conn->prepare($SQL1);
        $stmt->execute(["%{$q}%"]);
        $users = $stmt->fetchAll(PDO::FETCH_ASSOC);

        $stmt2 = $Conn->prepare($SQL2);
        $stmt2->execute(["%{$q}%"]);
        $categories = $stmt2->fetchAll(PDO::FETCH_ASSOC);

        $stmt3 = $Conn->prepare($SQL3);
        $stmt3->execute(["%{$q}%"]);
        $items = $stmt3->fetchAll(PDO::FETCH_ASSOC);

        $resulte = [
        "users" => $users,
        "categories" => $categories,
        "items" => $items
        ];

        return $resulte;

    }
}


?>


==================================================
=== FILE: ./Services/MemberService.php
==================================================
<?php

    namespace Services;
    use Repositories\UserRepository;
    use Core\Database\DBConnection;
    use Core\Helper\Alert;
use Core\Helper\FlashMessage;

    class MemberService {

         private UserRepository $repo;

    public function __construct() {
        $this->repo = new UserRepository((new DBConnection())->getConnection());
    }

    public function getMemberById(int $id) {
        return $this->repo->findById($id);
    }


    public function updateMember(array $data): bool {

        $userid   = intval($data['userid']);

        $username = trim($data['username']);

        $email    = trim($data['email']);
        
        $fullname = trim($data['fullName']);

        $password = !empty($data['newPassword'])
            ? password_hash($data['newPassword'], PASSWORD_DEFAULT)
            : $data['oldPassword'];

        return $this->repo->updateUser($userid, $username, $password, $email, $fullname);
    }


}


















?>


==================================================
=== FILE: ./Services/CategoryService.php
==================================================
<?php 

    namespace Services;

use Core\Database\DBConnection;
use Core\Helper\FlashMessage;
use Repositories\CategoryRepository;

    class CategoryService {
        private CategoryRepository $repo;


        public function __construct(CategoryRepository $repo)
        {
            $this->repo = $repo;
        }

        public function create(array $data) : bool {

            $error_log = [];
            

            if(empty($data['name'])) {

                $error_log[] = 'The Category Name is empty!';

            } elseif (empty($data['order'])) {

                $error_log[] = 'The Order Number is empty!';

            }

            if(!empty($error_log)) {
                FlashMessage::init();
                foreach($error_log as $error) {
                    FlashMessage::error($error . "<br><hr>");
                }
                return false;
            }

            $result = $this->repo->insert($data);
            return (bool) $result;

        }


    }







?>


==================================================
=== FILE: ./Services/ValidationService.php
==================================================
<?php

namespace Services;

class ValidationService {

    public static function isValidItemName(string $name): bool {
        // اسم المنتج: حروف + أرقام + مسافات، من 3 إلى 50 حرف
        return preg_match("/^[a-zA-Z0-9\s]{3,50}$/", $name);
    }

    public static function isValidDescription(string $desc): bool {
        // الوصف: على الأقل 10 أحرف، يسمح بالحروف والأرقام وبعض الرموز
        return preg_match("/^[a-zA-Z0-9\s\.,!?]{10,}$/", $desc);
    }

    public static function isValidPrice($price): bool {
        // السعر: رقم صحيح أو عشري بحد أقصى منزلتين عشريتين
        return preg_match("/^\d+(\.\d{1,2})?$/", $price);
    }

    public static function isValidCountry(string $country): bool {
        // البلد: حروف فقط، من 2 إلى 30 حرف
        return preg_match("/^[a-zA-Z\s]{2,30}$/", $country);
    }

    public static function isValidRating($rating): bool {
        // التقييم: رقم من 0 إلى 5
        return preg_match("/^[0-5]$/", $rating);
    }
}



==================================================
=== FILE: ./Services/LanguageLoader.php
==================================================
<?php

    namespace Services;

    use Core\Abstracts\AbstractLanguage;
    use Core\Interfaces\ILanguage;

    class LanguageLoader extends AbstractLanguage implements ILanguage {}


?>


==================================================
=== FILE: ./Services/SessionsServices.php
==================================================
<?php

    namespace Services;

    use Core\Abstracts\AbstractSessions;
    use Core\Interfaces\ISessions;

    class SessionsServices extends AbstractSessions implements ISessions {}

?>


==================================================
=== FILE: ./Controllers/AuthController.php
==================================================
<?php

namespace Controllers;

use Core\Database\DBConnection;
use Core\Helper\Alert;
use Services\AuthLogin;
use Services\SessionsServices;
use Core\Helper\URL;
use Repositories\UserRepository;
use Views\Layouts\Footer;
use Views\Layouts\Head;


class AuthController {

    private AuthLogin $auth;
    private SessionsServices $session;

    public function __construct(AuthLogin $login = null)
    {
        $this->auth = $login ?? new AuthLogin((new UserRepository((new DBConnection())->getConnection())));
        $this->session = new SessionsServices();
    }

    public function renderLoginView(string $message = '', string $type = 'info') {

        echo (new Head('Login System', 'login'))->Render();
        
        $alertMessage = !empty($message) ? Alert::Print($message, $type) : '';

        include BASE_PATH . '/Views/Pages/Main/Login.php';

        echo (new Footer('script', ''))->Render();

    }

    public function login() {

        if ($_SERVER['REQUEST_METHOD'] === 'POST') {

            $username = filter_input(INPUT_POST, 'username', FILTER_SANITIZE_SPECIAL_CHARS) ?? '';
            $password = filter_input(INPUT_POST, 'password', FILTER_SANITIZE_SPECIAL_CHARS) ?? '';

            if(!empty($username) && !empty($password)) {

                $row = $this->auth->verifyLogin($username, $password);

                if ($row) {
                    
                    $this->session->start();
                    $this->session->set('username', $username);
                    $this->session->set('UserID', $row->userID);
    
                    # Go to Dashboard
    
                    URL::redirect('dashboard');
                    
                } else {
                    $this->renderLoginView('Invalid Username OR Password');
                }

            } else {
                $this->renderLoginView('Error');
            }

        } else {
            // in First Time: Show Login Form
            $this->renderLoginView('');
        }
    }
}
?>


==================================================
=== FILE: ./Controllers/CategoriesController.php
==================================================
<?php 

namespace Controllers;

use Core\Helper\FlashMessage;
use Core\Helper\URL;
use Repositories\CategoryRepository;
use Repositories\ItemRepository;
use Services\SessionsServices;
use Services\CSRFToken;
use Exception;

class CategoriesController {

    public function __construct()
    {
            new SessionsServices();
    }

    public function index() {
        // $repo = new CategoryRepository( ( new DBConnection() )->getConnection() );
        // $rows = $repo->findById(1);

        $repo = new CategoryRepository();
        $rows = $repo->showAllCategories('DESC');

        $repoItem = new ItemRepository();
        $items = $repoItem->getItemFromCategories();

        include BASE_PATH . '/Views/Pages/Categories/ShowCategories.php';
    }

    public function insert() {
    if ($_SERVER['REQUEST_METHOD'] == 'POST') {
        $categoryData = [
            'name'        => trim($_POST['name'] ?? ''),
            'description' => trim($_POST['description'] ?? ''),
            'order'       => (int)($_POST['order'] ?? 0),
            'visible'     => (int)($_POST['visible'] ?? 1),
            'comments'    => (int)($_POST['comments'] ?? 1),
            'ads'         => (int)($_POST['ads'] ?? 1),
        ];

        $repo = new CategoryRepository();

        if ($repo->isExist($categoryData['name'])) {
            FlashMessage::init();
            FlashMessage::warning('This Category Already Exists');
            URL::redirect('categories/add');
        } else {
            $status = $repo->insert($categoryData);
            if ($status) {
                FlashMessage::init();
                FlashMessage::success("Category Added");
                URL::redirect('categories');
            } else {
                FlashMessage::init();
                FlashMessage::error('Error adding category');
                URL::redirect('categories/add');
            }
        }
    }

    include BASE_PATH . '/Views/Pages/Categories/AddCategory.php';
}


    public function edit($id) {

        $repo = new CategoryRepository();
        $rows = $repo->findById($id);

        include BASE_PATH . '/Views/Pages/Categories/EditCategory.php';

    }

    public function update($id) {

         $csrf = new CSRFToken();
        
        if(!$csrf->validateRequest($_SERVER, $_POST)) {
            http_response_code(419);
            FlashMessage::init();
            FlashMessage::error('Page Expired! - ERROR 419');
            return;
        }
        
        if($_SERVER['REQUEST_METHOD'] === 'POST') {
            
             $repo = new CategoryRepository();

                if($repo->isExist($_POST['name'], $id)) {
                    FlashMessage::init();
                    FlashMessage::warning('This Category Already Exists');
                } else {
                    $repo->update($_POST);
                }
        }
    }

        public function delete($id) {
            try {
                $repo = new CategoryRepository();

                if ($repo->delete($id)) {
                    FlashMessage::init();
                    FlashMessage::success('Category deleted successfully!');
                    URL::redirect('categories');
                } else {
                    FlashMessage::init();
                    FlashMessage::error('Failed to delete category.');
                    URL::redirect('categories');
                }
            } catch (Exception $e) {
                FlashMessage::init();
                FlashMessage::error('Error: ' . $e->getMessage());
                URL::redirect('categories');
            }
        }

}

?>


==================================================
=== FILE: ./Controllers/MembersController.php
==================================================
<?php

namespace Controllers;

use Core\Database\DBConnection;
use Core\Helper\FlashMessage;
use Core\Helper\URL;
use Repositories\UserRepository;
use Services\CSRFToken;
use Services\MemberService;
use Services\SessionsServices;

class MembersController {

    private MemberService $Service;
    private UserRepository $repo;

    public function __construct()
    {
        $this->Service = new MemberService();
        $this->repo = new UserRepository((new DBConnection())->getConnection());
    }

    public function index() {
        $rows = $this->repo->getAllMembers();
        include BASE_PATH . '/Views/Pages/Members/MemberManage.php';
    }

    public function getPendingUsers() {
        $rows = $this->repo->getPendingUser();
        include BASE_PATH . '/Views/Pages/MemberManage.php';
    }

    public function acceptUser(int $id): void {
        $this->repo->acceptUser($id);
        FlashMessage::init();
        FlashMessage::success('The user has been accepted');
        URL::redirect('members');
    }

    public function edit(int $id) {

        $user = $this->Service->getMemberById($id);

        if ($user) {
            $userRecord = $user;
            include BASE_PATH . '/Views/Pages/Members/EditMembers.php';
        } else {
            FlashMessage::init();
            FlashMessage::error("المستخدم غير موجود");
            URL::redirect('404');
        }
    }

    public function delete(int $id) {
    // Dont delete Myself :o
    if ($id == $_SESSION['UserID']) {
        FlashMessage::error('You cannot delete your own account!');
        URL::redirect('members');
        return;
    }

    if ($this->repo->deleteUser($id)) {
        FlashMessage::init();
        FlashMessage::success('The user has been deleted');
    } else {
        FlashMessage::init();
        FlashMessage::error('Failed to delete user or user not found');
    }
    
    URL::redirect('members');
}

    public function insert() {
        if ($_SERVER['REQUEST_METHOD'] === "POST") {
            $username = trim($_POST['username']);
            $password = $_POST['newPassword'];
            $email    = trim($_POST['email']);
            $fullname = trim($_POST['fullName']);
            $avatar   = null;

            if ($this->repo->exists($username, $email)) {
                FlashMessage::init();
                FlashMessage::warning('This user already exists');
            } else {
                $status = $this->repo->insertUser($username, $password, $email, $fullname, $avatar);
                FlashMessage::init();
                if ($status) {
                    FlashMessage::success('Member added successfully');
                } else {
                    FlashMessage::error('Failed to add member');
                }
            }
            URL::redirect('members');
        }

        include BASE_PATH . '/Views/Pages/AddMember.php';
    }

    public function update() {

        $csrf = new CSRFToken();
        
        if(!$csrf->validateRequest($_SERVER, $_POST)) {
            http_response_code(419);
            FlashMessage::init();
            FlashMessage::error('Page Expired! - ERROR 419');
            return;
        }

        if ($_SERVER['REQUEST_METHOD'] === 'POST') {
            $errors = [];

            if (empty($_POST['username']) || strlen($_POST['username']) < 3) {
                $errors[] = "Invalid username";
            }
            if (empty($_POST['email'])) {
                $errors[] = "Invalid email";
            }

            if (!empty($errors)) {
                FlashMessage::init();
                foreach ($errors as $error) {
                    FlashMessage::error($error);
                }
                URL::redirect('members/edit/' . ($_POST['id'] ?? 0));
                return;
            }

            $this->Service->updateMember($_POST);
            FlashMessage::init();
            FlashMessage::success('Member updated successfully');
            URL::redirect('members');

        } else {
            URL::redirect('404');
        }
    }
}

?>



==================================================
=== FILE: ./Controllers/ItemController.php
==================================================
<?php

namespace Controllers;

use Core\Helper\FlashMessage;
use Core\Helper\URL;
use Repositories\ItemRepository;
use Repositories\CategoryRepository;
use Repositories\UserRepository;
use Services\SessionsServices;
use Services\CSRFToken;

class ItemController {

    public function __construct()
    {
        new SessionsServices();
    }

    public function index() {
        echo 'show Items';
    }

    private function getItemDataFromPost(): array
    {
        return [
            'id'          => isset($_POST['item-id']) ? (int) $_POST['item-id'] : 0,
            'name'        => trim($_POST['item-name'] ?? ''),
            'description' => trim($_POST['item-description'] ?? ''),
            'price'       => (float) ($_POST['item-price'] ?? 0),
            'country'     => trim($_POST['item-country'] ?? ''),
            'status'      => (int) ($_POST['item-status'] ?? 0),
            'rating'      => (int) ($_POST['item-rating'] ?? 0),
            'catId'       => (int) ($_POST['cat-id'] ?? 0),
            'memberId'    => (int) ($_POST['member-id'] ?? 0),
        ];
    }

    public function insert() {
        $repo = new ItemRepository();
        $Cats = $repo->getCategoriesNameAID();
        $Members = $repo->getUsersWithID();

        if ($_SERVER['REQUEST_METHOD'] === 'POST') {
            $required = ['item-name', 'item-description', 'item-price', 'item-country', 'item-status', 'item-rating', 'cat-id', 'member-id'];

            foreach ($required as $req) {
                if (empty($_POST[$req])) {
                    FlashMessage::init();
                    FlashMessage::error('Please fill all fields');
                    URL::redirect('items/add');
                    return;
                }
            }

            $data = $this->getItemDataFromPost();

            if ($data['price'] < 0) {
                FlashMessage::init();
                FlashMessage::error('Invalid price');
                URL::redirect('items/add');
                return;
            }

            $status = $repo->insert(
                $data['name'], $data['description'], $data['price'], $data['country'],
                $data['status'], $data['rating'], $data['catId'], $data['memberId']
            );

            FlashMessage::init();
            if ($status) {
                FlashMessage::success('Item inserted successfully!');
                URL::redirect('items');
            } else {
                FlashMessage::error('Failed to insert item');
                URL::redirect('items/add');
            }
        }

        include BASE_PATH . '/Views/Pages/Items/AddItem.php';
    }

    public function edit($id) {
        $repo = new ItemRepository();
        $row = $repo->findById($id);

        $repo2 = new CategoryRepository();
        $Cats = $repo2->showAllCategories();

        $repo3 = new UserRepository();
        $Members = $repo3->getAllMembers();

        include BASE_PATH . '/Views/Pages/Items/EditItem.php';
    }

    public function update() {

         $csrf = new CSRFToken();
        
        if(!$csrf->validateRequest($_SERVER, $_POST)) {
            http_response_code(419);
            FlashMessage::init();
            FlashMessage::error('Page Expired! - ERROR 419');
            return;
        }

        if ($_SERVER['REQUEST_METHOD'] === 'POST') {
            $data = $this->getItemDataFromPost();

            if ($data['price'] < 0) {
                FlashMessage::init();
                FlashMessage::error('Invalid price');
                URL::redirect('items/edit/' . $data['id']);
                return;
            }

            $repo = new ItemRepository();
            $status = $repo->update(
                $data['id'], $data['name'], $data['description'], $data['price'],
                $data['country'], $data['status'], $data['rating'], $data['catId'], $data['memberId']
            );

            FlashMessage::init();
            if ($status) {
                FlashMessage::success('Item updated successfully!');
                URL::redirect('items/manage');
            } else {
                FlashMessage::error('Failed to update item');
            }
        }
    }

    public function delete($id) {
        $repo = new ItemRepository();
        $status = $repo->delete($id);

        FlashMessage::init();
        if ($status) {
            FlashMessage::success('Item deleted successfully!');
        } else {
            FlashMessage::error('Failed to delete item');
        }
        URL::redirect('items');
    }
}

?>



==================================================
=== FILE: ./Controllers/DashboardController.php
==================================================
<?php

namespace Controllers;

use Services\APIServices;
use Views\Layouts\Footer;
use Views\Layouts\Head;

class DashboardController {
    private APIServices $api;

    public function __construct() {
        $this->api = new APIServices();
    }

    public function index() {
        echo (new Head('Dashboard', 'dashboard'))->Render();
        include BASE_PATH . '/Views/Pages/Dashboard.php';
        echo (new Footer('script', 'chart.umd.min'))->Render();
    }

    private function jsonResponse($data): void {
        header('Content-Type: application/json; charset=utf-8');
        echo json_encode($data, JSON_UNESCAPED_UNICODE);
    }

    public function getUsersWithDates(): void {
        $this->jsonResponse($this->api->getUsersWithDates());
    }

    public function getCats(): void {
        $this->jsonResponse($this->api->getItemsCountWithCats());
    }

    public function getCountryMade(): void {
        $this->jsonResponse($this->api->getCountryMade());
    }

    public function searchBox(): void {
        $q = $_GET['q'] ?? '';
        $this->jsonResponse($this->api->searchData($q));
    }
}



==================================================
=== FILE: ./Repositories/CategoryRepository.php
==================================================
<?php 

    namespace Repositories;

use Core\Database\DBConnection;
use Model\Category;
use PDO;
use Stringable;

    class CategoryRepository {

        private PDO $PDO;

        public function __construct(?PDO $pdo = null)
        {
            $this->PDO = $pdo ?? (new DBConnection())->getConnection();
        }

        public function showAllCategories(string $sort = 'ASC') : array {

            if($sort == 'DESC') {
            $SQL = 'SELECT * FROM categories ORDER BY `Order` ' . $sort;
            } else {

                $SQL = "SELECT * FROM categories";

            }


            $stmt = $this->PDO->prepare($SQL);
            $stmt->execute();

            return $stmt->fetchAll(PDO::FETCH_ASSOC) ?? [];

        }

        public function findById(int $id) : ?Category {

             $SQL = 'SELECT * FROM categories WHERE ID = ?';

            $stmt = $this->PDO->prepare($SQL);
            $stmt->execute([$id]);
            $Data = $stmt->fetch(PDO::FETCH_ASSOC);

           if(empty($Data)) return null;

            return new Category (
                (int)$Data['ID'],
                (string)$Data['Name'],
                (string)$Data['Description'],
                (int)$Data['Order'],
                (int)$Data['Visibility'],
                (int)$Data['Allow_Comment'],
                (int)$Data['Allow_Ads'],

            );
        }
        public function isExist(string $name, ?int $id = null) : bool {

            $SQL = "SELECT COUNT(*) FROM categories WHERE `Name` = ? AND `ID` != ? ";

            $stmt = $this->PDO->prepare($SQL);
            $stmt->execute([$name, $id]);

            return (int) $stmt->fetchColumn() > 0;

        }

        public function update(array $data) : bool {

             $SQL = "UPDATE categories SET 
                `Name` = :name, 
                `Description` = :description, 
                `Order` = :order, 
                `Visibility` = :visibility, 
                `Allow_Comment` = :allow_comment, 
                `Allow_Ads` = :allow_ads 
                WHERE `ID` = :id";
            
            $stmt = $this->PDO->prepare($SQL);
            return $stmt->execute([
                ':name'           => $data['name'],
                ':description'    => $data['description'],
                ':order'          => $data['order'],
                ':visibility'     => $data['visible'],
                ':allow_comment'  => $data['comments'],
                ':allow_ads'      => $data['ads'],
                ':id'             => $data['id']
            ]);

        }

        public function insert(array $data) : bool {
            
            $SQL = "INSERT INTO `categories` (`Name`, `Description`, `Order`, `Visibility`, `Allow_Comment`, `Allow_Ads`)
                            VALUES (:name, :description, :order, :visibility, :allow_comment, :allow_ads); ";

            $stmt = $this->PDO->prepare($SQL);
           return $stmt->execute([
                ':name'             => $data['name'],
                ':description'      => $data['description'],
                ':order'            => $data['order'],
                ':visibility'       => $data['visible'],
                ':allow_comment'    => $data['comments'],
                ':allow_ads'        => $data['ads']
            ]);

        }

        public function delete($id) : bool {

            $SQL = "DELETE FROM categories WHERE `categories`.`ID` = ?";

             $stmt = $this->PDO->prepare($SQL);
            $stmt->execute([$id]);

            return (int) $stmt->rowCount() > 0;

        }

        

    }














?>


==================================================
=== FILE: ./Repositories/ItemRepository.php
==================================================
<?php

namespace Repositories;

use Core\Database\DBConnection;
use Core\Helper\Alert;
use PDO;
use PDOException;

class ItemRepository
{
    private PDO $pdo;

    public function __construct(?PDO $pdo = null)
    {
        $this->pdo = $pdo ?? (new DBConnection())->getConnection();
    }

   public function insert(string $name, string $description, int $price, string $country, int $status, int $rating, int $cat_id, int $member_id, ?string $image = null, int $approve = 0): bool {
    try {
        $SQL = "INSERT INTO `items` 
                (`Item_name`, `Item_description`, `Price`, `Add_Date`, `Country_Made`, `Image`, `Status_Item`, `Rating`, `Cat_ID`, `Member_ID`, `Approve`)
                VALUES (:name, :description, :price, NOW(), :country, :image, :status, :rating, :cat_id, :member_id, :approve)";

        $stmt = $this->pdo->prepare($SQL);

        // Bind parameters
        $stmt->bindParam(':name', $name, PDO::PARAM_STR);
        $stmt->bindParam(':description', $description, PDO::PARAM_STR);
        $stmt->bindParam(':price', $price, PDO::PARAM_INT);
        $stmt->bindParam(':country', $country, PDO::PARAM_STR);
        if ($image === null) {
            $stmt->bindValue(':image', null, PDO::PARAM_NULL);
        } else {
            $stmt->bindParam(':image', $image, PDO::PARAM_STR);
        }
        $stmt->bindParam(':status', $status, PDO::PARAM_INT);
        $stmt->bindParam(':rating', $rating, PDO::PARAM_INT);
        $stmt->bindParam(':cat_id', $cat_id, PDO::PARAM_INT);
        $stmt->bindParam(':member_id', $member_id, PDO::PARAM_INT);
        $stmt->bindParam(':approve', $approve, PDO::PARAM_INT);

        return $stmt->execute();
    } catch (PDOException $e) {
        return $e->getMessage();
    }
}



    public function getCategoriesNameAID() : ?array {

        $SQL = "SELECT categories.Name, categories.ID FROM categories";
        $stmt = $this->pdo->prepare($SQL);
        $stmt->execute([]);

        return $stmt->fetchAll(PDO::FETCH_ASSOC) ?? null;

    }

    public function getUsersWithID() : ?array {

        $SQL = "SELECT users.Username, users.UserID FROM users";
        $stmt = $this->pdo->prepare($SQL);
        $stmt->execute([]);

        return $stmt->fetchAll(PDO::FETCH_ASSOC) ?? null;

    }

    public function findById($id) {

        $SQL = "SELECT * FROM items WHERE Item_id = ?";
        $stmt = $this->pdo->prepare($SQL);
        $stmt->execute([$id]);

        return $stmt->fetch(PDO::FETCH_ASSOC) ?? [];

    }


    public function getItemFromCategories() {

        $SQL = "SELECT items.Item_name AS Name, categories.Name AS `Cat Name`, items.Cat_ID AS ICI, categories.ID AS CID FROM items
                INNER JOIN categories ON categories.ID = items.Cat_ID";

        $stmt = $this->pdo->prepare($SQL);
        $stmt->execute([]);

        return $stmt->fetchAll(PDO::FETCH_ASSOC) ?? null;


    }

                    public function update(
                    int $id,
                    string $name,
                    string $description,
                    float $price,
                    string $country,
                    int $status,
                    int $rating,
                    int $catid,
                    int $memberid
                ) : bool {

                    $SQL = "UPDATE `items` 
                            SET `Item_name` = ?, 
                                `Item_description` = ?, 
                                `Price` = ?, 
                                `Country_Made` = ?, 
                                `Status_Item` = ?, 
                                `Rating` = ?, 
                                `Cat_ID` = ?, 
                                `Member_ID` = ?, 
                                `Approve` = 1
                            WHERE `Item_id` = ?";

                    $stmt = $this->pdo->prepare($SQL);

                    return $stmt->execute([
                        $name,
                        $description,
                        $price,
                        $country,
                        $status,
                        $rating,
                        $catid,
                        $memberid,
                        $id
                    ]);
                }


            public function delete($id) : bool {

                $SQL = "DELETE FROM items WHERE `Item_id` = ?";

                $stmt = $this->pdo->prepare($SQL);
                $stmt->execute([$id]);

            return (int) $stmt->rowCount() > 0;

        }

        public function getItemWithCatsAnalisys() : ?array {

            $SQL = "SELECT categories.Name, COUNT(items.Item_id) AS ItemCount
                    FROM items
                    JOIN categories ON items.Cat_ID = categories.ID
                    GROUP BY categories.Name;
                    ";

                $stmt = $this->pdo->prepare($SQL);
                $stmt->execute([]);

            return $stmt->fetchAll(PDO::FETCH_ASSOC) ?? [];

        }

        public function getCountryMadeAPI() : ?array {

            $SQL = "SELECT Country_Made, COUNT(*) AS ItemCount
                    FROM items
                    GROUP BY Country_Made
                    ORDER BY ItemCount DESC;
                    ";
            $stmt = $this->pdo->prepare($SQL);
            $stmt->execute([]);

            return $stmt->fetchAll(PDO::FETCH_ASSOC) ?? [];

        }



}


==================================================
=== FILE: ./Repositories/UserRepository.php
==================================================
<?php

    namespace Repositories;

use Core\Database\DBConnection;
use DateTime;
use Exception;
use Model\User;
    use PDO;

    class UserRepository {

        private PDO $PDO;

        public function __construct(PDO $DB = null)
        {
            $this->PDO = (new DBConnection())->getConnection();
        }

        public function findById(int $id) : ?User {

            $SQL = 'SELECT * FROM users WHERE UserID = ? LIMIT 1';

            $stmt = $this->PDO->prepare($SQL);
            $stmt->execute([$id]);
            $Data = $stmt->fetch(PDO::FETCH_ASSOC);

                if(empty($Data)) return null;

                return new User(
                    (int)$Data['UserID'],
                    (string)$Data['Username'],
                    (string)$Data['Password'],
                    (string)$Data['Email'],
                    (string)$Data['FullName'],
                    (int)$Data['UserType'],
                    (int)$Data['TrustStatus'],
                    (int)$Data['RegStatus'],
                    $Data['Date_Reg'],
                    isset($Data['Avatar']) != null ? (string)$Data['Avatar'] : ''

                );

        }

        public function findByUsername(string $username): ?User {
        $stmt = $this->PDO->prepare("SELECT * FROM users WHERE Username = ?");
        $stmt->execute([$username]);
        $data = $stmt->fetch(PDO::FETCH_ASSOC);

        if (!$data) {
            return null;
        }

        return new User(
            (int)$data['UserID'],
            (string)$data['Username'],
            (string)$data['Password'],
            (string)$data['Email'],
            (string)$data['FullName'],
            isset($data['UserType']) ? (int)$data['UserType'] : 0,
            isset($data['TrustStatus']) ? (int)$data['TrustStatus'] : 0,
            isset($data['RegStatus']) ? (int)$data['RegStatus'] : 0,
            $data['Date_Reg'],
            isset($data['Avatar']) ? (string)$data['Avatar'] : null
        );
    }

    public function updateUser(int $id, string $username, string $password, string $email, string $fullname) : bool {

        $SQL = "UPDATE users SET `Username` = ?, `Password` = ?, `Email` = ?, `FullName` = ? WHERE `UserID` = ?";
        $stmt = $this->PDO->prepare($SQL);
        $stmt->execute([$username, $password, $email, $fullname, $id]);
        $count = $stmt->rowCount();

        if($count > 0) {
            return true;
        }
        else {
            return false;
        }

    }

    public function insertUser(string $username, string $password, string $email, string $fullname, ?string $avatar) : bool {

       $SQL = "INSERT INTO users 
                (`Username`, `Password`, `Email`, `FullName`, `UserType`, `TrustStatus`, `RegStatus`, `Date_Reg`, `Avatar`) 
                VALUES (:username, :password, :email, :fullname, :usertype, :truststatus, :regstatus, :datereg, :avatar)";
                
        $success = false;

            try {

                $stmt = $this->PDO->prepare($SQL);
                    $success = $stmt->execute([
                    ':username'   => $username,
                    ':password'   => $password,
                    ':email'      => $email,
                    ':fullname'   => $fullname,
                    ':usertype'   => 0,
                    ':truststatus'=> 0,
                    ':regstatus'  => 0,
                    ':datereg'    => date('Y-m-d H:i:s'),
                    ':avatar'     => $avatar ?? null
                ]);

            } catch (\PDOException $error) {
                throw new \Exception("Database Insert Failed: " . $error->getMessage());
            }

            return (bool)$success;


    }

    public function exists(string $username, string $email) : bool {

        $SQL = "SELECT COUNT(*) FROM users WHERE Username = ? OR Email = ?";
        $stmt = $this->PDO->prepare($SQL);
        $stmt->execute([
            $username,
            $email
        ]);

        return $stmt->fetchColumn() > 0;

    }
    public function getAllMembers($limit = null, $sort = "ASC") : array {

    $sort = strtoupper($sort) === "DESC" ? "DESC" : "ASC";

    $SQL = "SELECT * FROM users ORDER BY Username $sort";
    if (!empty($limit)) {
        $SQL .= " LIMIT :limit";
    }

    $stmt = $this->PDO->prepare($SQL);

    if (!empty($limit)) {
        $stmt->bindValue(':limit', (int)$limit, PDO::PARAM_INT);
    }

    $stmt->execute();
    return $stmt->fetchAll(PDO::FETCH_ASSOC);
}



    public function deleteUser(int $id) : bool {

        $SQL = 'DELETE FROM users WHERE `users`.`UserID` = ?';
        $stmt = $this->PDO->prepare($SQL);
        $stmt->execute([$id]);

        return $stmt->rowCount() > 0;

    }

    public function getUsersAndDates() : array {
        $SQL = "SELECT YEAR(Date_Reg) AS year, COUNT(*) AS count FROM users GROUP BY year ORDER BY year";

        $stmt = $this->PDO->prepare($SQL);
        $stmt->execute();
        $rows = $stmt->fetchAll(PDO::FETCH_ASSOC);

        return $rows ?? [];
    }

    public function sumCountAllUsers() : int {
        $SQL = "SELECT COUNT(Username) FROM users";

        $stmt = $this->PDO->prepare($SQL);
        $stmt->execute();

        return $stmt->fetchColumn() ?? 0;
    }

     public function getPendingUser() : array {
        $SQL = "SELECT * FROM users WHERE RegStatus = ?";

        $stmt = $this->PDO->prepare($SQL);
        $stmt->execute([0]);
        $rows = $stmt->fetchAll(PDO::FETCH_ASSOC);

        return $rows ?? [];
    }

    public function acceptUser($id) : bool {
        $SQL = "UPDATE users SET RegStatus = 1 WHERE UserID = ?";

        $stmt = $this->PDO->prepare($SQL);
        $stmt->execute([$id]);
        

        return $stmt->rowCount() > 0;
    }

    public function countPendingMember() : int {
        $SQL = "SELECT COUNT(Username) FROM users WHERE RegStatus = 0";

        $stmt = $this->PDO->prepare($SQL);
        $stmt->execute();

        return $stmt->rowCount() ?? 0;
    }

}



