export default class API {

    constructor() {

        this.api = new API();

    }

    renderUsersDatesChart() {
                    fetch('/api/getUsersWithDates')
            .then(res => res.json())
            .then(rows => {
                const labels = rows.map(r => r.year);         // السنوات
                const data = rows.map(r => Number(r.count));  // عدد المستخدمين

                const ctx = document.getElementById('charts').getContext('2d');
                new Chart(ctx, {
                type: 'line',
                data: {
                    labels,
                    datasets: [{
                    label: 'عدد المستخدمين لكل سنة',
                    data,
                    backgroundColor: 'rgba(0, 54, 90, 0.5)',
                    borderColor: 'rgba(0, 102, 170, 1)',
                    borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                    title: {
                        display: true,
                        text: 'إحصائية تسجيل المستخدمين حسب السنة'
                    }
                    },
                    scales: {
                    y: {
                        beginAtZero: true,
                        ticks: { stepSize: 1 }
                    }
                    }
                }
                });
            });

        }

        renderCatsAPI() {
                fetch('api/getCats')
                    .then(response => {
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    return response.json();
                    })
                    .then(data => {
                    if (!Array.isArray(data) || data.length === 0) {
                        console.warn("No data available for chart.");
                        return;
                    }

                    const labels = data.map(item => item.Name);
                    const counts = data.map(item => item.ItemCount);

                    const ctx = document.getElementById('categoryChart').getContext('2d');

                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                        labels: labels,
                        datasets: [{
                            label: 'عدد العناصر حسب الفئة',
                            data: counts,
                            backgroundColor: 'rgba(54, 162, 235, 0.6)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1
                        }]
                        },
                        options: {
                        responsive: true,
                        scales: {
                            y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'عدد العناصر'
                            }
                            },
                            x: {
                            title: {
                                display: true,
                                text: 'الفئة'
                            }
                            }
                        },
                        plugins: {
                            title: {
                            display: true,
                            text: 'إحصائية عدد العناصر حسب الفئة'
                            }
                        }
                        }
                    });
                    })
                    .catch(error => {
                    console.error("Error rendering chart:", error);
                    });
        }

}import API from "./chartsAPI";



class AppUI {


    

    constructor() {
        // عناصر الإدخال
        this.userInput = document.querySelector('.username');
        this.passwordInput = document.querySelector('.password');
        this.ulMenuUserParent = document.querySelector('.information-user');

        // الحقول المطلوبة
        this.allInputFields = Array.from(document.querySelectorAll('input'));
        this.requiredFields = this.allInputFields.filter(input => input.required);

        // عناصر القائمة المنسدلة
        this.navDropDownMenu = document.querySelector('.ndd-list');
        this.navDropDownMenuName = document.querySelector('.nav-drop-down > span');

        // أيقونة إظهار كلمة المرور
        this.eyePasswordField = document.querySelector("#eye");

        // عناصر الداشبورد
        this.headerInfo = Array.from(document.querySelectorAll(".latest-info"));
        this.icons = document.querySelectorAll(".lt-pm");

        // عناصر الحذف
        this.deleteButtons = document.querySelectorAll('.delete-control');

        this.burgerSideBar = document.querySelector('.side-br');

        this.aside = document.querySelector('aside');

        new API();
    }

    init() {
        this.toggleNavMenu();
        this.togglePasswordVisibility();
        this.dashboardToggle();
        this.addRequiredAsterisk();
        this.togglePlaceholder(this.userInput);
        this.togglePlaceholder(this.passwordInput);
        this.confirmDelete();
        this.showLoaderOnLoad();
        this.renderUsersDatesChart();
        this.toggleSideBarStatus();
        this.renderCatsAPI();
        API.renderCatsAPI();
    }

    toggleNavMenu() {
        if (this.navDropDownMenuName) {
            this.navDropDownMenuName.addEventListener('click', () => {
                this.navDropDownMenu.classList.toggle('show');
            });
        }
    }

    togglePasswordVisibility() {
        if (this.eyePasswordField) {
            this.eyePasswordField.addEventListener("click", () => {
                if (this.passwordInput.getAttribute("type") === "password") {
                    this.passwordInput.setAttribute("type", "text");
                } else {
                    this.passwordInput.setAttribute("type", "password");
                }
            });
        }
    }

    toggleSideBarStatus() {
        this.burgerSideBar.addEventListener('click', () => {

            this.aside.classList.toggle('hide');

        });
    }

    dashboardToggle() {
        this.headerInfo.forEach((div, n) => {
            div.onclick = () => {
                div.nextElementSibling.classList.toggle("animation");

                if (this.icons[n].classList.contains("fa-plus")) {
                    this.icons[n].classList.add("fa-minus");
                    this.icons[n].classList.remove("fa-plus");
                } else if (this.icons[n].classList.contains("fa-minus")) {
                    this.icons[n].classList.add("fa-plus");
                    this.icons[n].classList.remove("fa-minus");
                }
            };
        });
    }

    addRequiredAsterisk() {
        this.requiredFields.forEach(input => {
            const astrisk = document.createElement('span');
            astrisk.textContent = "*";
            astrisk.classList.add("astrisk");
            input.insertAdjacentElement('afterend', astrisk);
        });
    }

    togglePlaceholder(input) {
        if (!input) return;
        const placeholderText = input.getAttribute('placeholder');
        input.addEventListener('focus', () => input.setAttribute("placeholder", ''));
        input.addEventListener('blur', () => input.setAttribute("placeholder", placeholderText));
    }

    confirmDelete() {
        this.deleteButtons.forEach(button => {
            button.addEventListener('click', (event) => {
                let status = confirm("Are You Sure?");
                if (!status) {
                    event.preventDefault();
                }
            });
        });
    }

    

    showLoaderOnLoad() {
        window.addEventListener('DOMContentLoaded', () => {
            const loaderIcon = document.querySelector('.load-icon');
            if (loaderIcon) {
                loaderIcon.classList.add('load-icon-show');
            }
        });
    }

    

   
    static showLoader() {
        document.getElementById("loader").style.display = "block";
    }
}

window.onload = () => {
    const app = new AppUI();
    app.init();
};
